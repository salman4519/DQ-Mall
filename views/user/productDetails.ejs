<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.name %> Details</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .carousel-item img {
            max-height: 500px; /* Adjust height as needed */
            object-fit: contain;
            position: relative;
        }
        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            background-color: #000; /* Dark background for arrows */
        }
        .carousel-control-prev,
        .carousel-control-next {
            filter: invert(1); /* Lighten arrows for better contrast */
        }
        .sidebar-images img {
            width: 100%;
            height: 245px;
            margin-bottom: 10px;
            border: 1px solid #100e0e; /* Optional: Add border for better visibility */
        }
        .sidebar-images img:hover {
            opacity: 0.7;
        }
        .product-details {
            display: flex;
            gap: 20px; /* Adjust spacing as needed */
        }
        .product-details .carousel-container {
            flex: 3;
        }
        .product-details .sidebar-container {
            flex: 1;
        }
        /* Magnifying Glass Effect */
        .zoom-container {
            position: relative;
            display: inline-block;
            overflow: hidden;
        }
        .zoom-container img {
            display: block;
        }
        .zoom-container .zoom-effect {
            position: absolute;
            border: 3px solid #000;
            width: 200px; /* Size of the magnifying glass */
            height: 200px;
            border-radius: 50%;
            cursor: none; /* Hide the cursor */
            overflow: hidden;
            top: 0;
            left: 0;
            background-repeat: no-repeat;
            background-size: 200% 200%; /* Ensure the zoomed image is larger */
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <!-- Logo Image -->
            <img src="/users/images/logo2.png" alt="Kenza Store Logo" class="navbar-brand-logo">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <form class="form-inline ml-5">
                <input class="form-control mr-sm-2 border" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-light my-2 my-sm-0" type="submit">Search</button>
            </form>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Shop</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Wishlist</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Cart</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contact Us</a>
                </li>
            </ul>
            <a href="/logout" class="btn btn-info ml-2">Logout</a>
        </div>
    </nav>

    <!-- Breadcrumbs -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <% if (product.CategoryId) { %>
                <li class="breadcrumb-item">
                    <a href="#">Category</a> <!-- Adjust if needed -->
                </li>
            <% } %>
            <li class="breadcrumb-item active" aria-current="page"><%= product.name %></li>
        </ol>
    </nav>

    <!-- Product Details -->
    <div class="container mt-4">
        <div class="product-details">
            <!-- Carousel for Product Images -->
            <div class="carousel-container">
                <div id="productCarousel" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <% for (let i = 0; i < product.Images.length; i++) { %>
                            <li data-target="#productCarousel" data-slide-to="<%= i %>" class="<%= i === 0 ? 'active' : '' %>"></li>
                        <% } %>
                    </ol>
                    <div class="carousel-inner">
                        <% product.Images.forEach((image, index) => { %>
                            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                <div class="zoom-container">
                                    <img src="/uploads/<%= image %>" class="d-block w-100" alt="Product Image" onmousemove="zoomImage(event, this)">
                                    <div class="zoom-effect">
                                        <img src="/uploads/<%= image %>" alt="Zoomed Product Image">
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                    <a class="carousel-control-prev" href="#productCarousel" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#productCarousel" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            <!-- Sidebar for Additional Images -->
            <div class="sidebar-container">
                <div class="sidebar-images">
                    <% product.Images.forEach((image, index) => { %>
                        <% if (index !== 0) { %> <!-- Exclude the main image from the sidebar -->
                            <div class="zoom-container">
                                <img src="/uploads/<%= image %>" alt="Product Image" onclick="showImageInCarousel('<%= image %>')" onmousemove="zoomImage(event, this)">
                                <div class="zoom-effect">
                                    <img src="/uploads/<%= image %>" alt="Zoomed Product Image">
                                </div>
                            </div>
                        <% } %>
                    <% }) %>
                </div>
            </div>
        </div>

        <h2 class="mt-4"><%= product.name %></h2>
        <p><strong>Price:</strong> $<%= product.Price %></p>
        <p><strong>Description:</strong> <%= product.Description %></p>
        <p><strong>Size:</strong> <%= product.Size %></p>
        <p><strong>Quantity:</strong> <%= product.Quantity %></p>

        <!-- Add to Cart Button -->
        <a href="#" class="btn btn-primary">Add to Cart</a>
        <a href="#" class="btn btn-dark">Buy Now</a>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        function showImageInCarousel(image) {
            let index = Array.from(document.querySelectorAll('#productCarousel .carousel-item img')).findIndex(img => img.src.includes(image));
            if (index !== -1) {
                $('#productCarousel').carousel(index);
            }
        }

        function zoomImage(event, img) {
            const zoomEffect = img.nextElementSibling;
            const { offsetX, offsetY, target } = event;
            const { width, height, left, top } = target.getBoundingClientRect();
            const x = (offsetX / width) * 100;
            const y = (offsetY / height) * 100;
            
            zoomEffect.style.backgroundImage = `url(${img.src})`;
            zoomEffect.style.backgroundPosition = `-${x}% -${y}%`;
            zoomEffect.style.display = 'block';

            zoomEffect.style.left = `${event.clientX - left - zoomEffect.offsetWidth / 2}px`;
            zoomEffect.style.top = `${event.clientY - top - zoomEffect.offsetHeight / 2}px`;
        }

        document.addEventListener('mousemove', (event) => {
            const zoomEffects = document.querySelectorAll('.zoom-effect');
            zoomEffects.forEach(zoomEffect => {
                const rect = zoomEffect.parentElement.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                if (x >= 0 && y >= 0 && x <= rect.width && y <= rect.height) {
                    zoomEffect.style.display = 'block';
                    zoomEffect.style.left = `${event.clientX - rect.left - zoomEffect.offsetWidth / 2}px`;
                    zoomEffect.style.top = `${event.clientY - rect.top - zoomEffect.offsetHeight / 2}px`;
                } else {
                    zoomEffect.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
